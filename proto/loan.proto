syntax = "proto3";

package loan;

service LoanService {
  rpc CreateLoan(CreateLoanRequest) returns (LoanResponse);
  rpc GetLoan(GetLoanRequest) returns (LoanResponse);
  rpc UpdateLoan(UpdateLoanRequest) returns (LoanResponse);
  rpc DeleteLoan(DeleteLoanRequest) returns (DeleteLoanResponse);
  rpc ListLoans(ListLoansRequest) returns (ListLoansResponse);
}

message Customer {
  string customerId = 1;
  string firstName = 2;
  string lastName = 3;
  optional string email = 4;
  string phoneNumber = 5;
}

message InterestRate {
  double annualPercentage = 1;
  double monthlyPercentage = 2;
  int32 totalInterestRupees = 3;
  int32 monthlyInterestRupees = 4;
}

message CompoundingDetails {
  double penaltyInterestRate = 1;
  double compoundedInterest = 2;
  double principalPenalty = 3;
  double totalPenaltyAmount = 4;
}

message LateFees {
  int32 feePerMonth = 1;
  int32 totalLateFees = 2;
}

message MissedPayments {
  int32 count = 1;
  int32 closed = 2;
  int32 totalMissedAmount = 3;
  CompoundingDetails compoundingDetails = 4;
  LateFees lateFees = 5;
}

message CurrentOutstanding {
  int32 remainingPrincipal = 1;
  int32 pendingInterest = 2;
  int32 penaltyAmount = 3;
  int32 lateFees = 4;
  int32 totalOutstanding = 5;
  string lastCalculatedDate = 6;
}

message LoanProvider {
  string userId = 1;
  string username = 2;
  string firstName = 3;
  string lastName = 4;
  string email = 5;
}

message Loan {
  string loanId = 1;
  Customer customer = 2;
  int32 originalPrincipal = 3;
  int32 currentPrincipal = 4;
  InterestRate interestRate = 5;
  int32 termMonths = 6;
  int32 remainingTerms = 7;
  string repaymentFrequency = 8;
  string type = 9;
  string startDate = 10;
  string endDate = 11;
  int32 expectedMonthlyPayment = 12;
  MissedPayments missedPayments = 13;
  CurrentOutstanding currentOutstanding = 14;
  string status = 15;
  string substatus = 16;
  LoanProvider loanProvider = 17;
  string createdAt = 18;
  string updatedAt = 19;
}

message CreateLoanRequest {
  Customer customer = 1;
  int32 originalPrincipal = 2;
  InterestRate interestRate = 3;
  int32 termMonths = 4;
  string repaymentFrequency = 5;
  string type = 6;
  string startDate = 7;
  string endDate = 8;
  LoanProvider loanProvider = 9;
}

message UpdateLoanRequest {
  string loanId = 1;
  optional int32 currentPrincipal = 2;
  optional int32 remainingTerms = 3;
  optional MissedPayments missedPayments = 4;
  optional CurrentOutstanding currentOutstanding = 5;
  optional string status = 6;
  optional string substatus = 7;
}

message GetLoanRequest {
  string loanId = 1;
}

message DeleteLoanRequest {
  string loanId = 1;
}

message ListLoansRequest {
  optional int32 page = 1;
  optional int32 limit = 2;
  optional string customerId = 3;
  optional string status = 4;
  optional string substatus = 5;
  optional string search = 6;
  optional string sortBy = 7;
  optional string sortOrder = 8;
}

message LoanResponse {
  bool success = 1;
  optional string message = 2;
  optional Loan data = 3;
  optional string error = 4;
}

message DeleteLoanResponse {
  bool success = 1;
  optional string message = 2;
  optional string error = 3;
}

message ListLoansResponse {
  bool success = 1;
  repeated Loan loans = 2;
  int32 total = 3;
  int32 page = 4;
  int32 limit = 5;
  optional string error = 6;
}